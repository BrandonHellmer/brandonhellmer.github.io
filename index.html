<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AE Core — Safety & Verification</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;line-height:1.4;color:#111;background:#fafafa}
    header{padding:22px 18px;background:#111;color:#fff}
    header h1{margin:0;font-size:22px}
    nav a{color:#fff;margin-right:14px;text-decoration:none;font-weight:600}
    main{max-width:900px;margin:0 auto;padding:18px}
    .card{background:#fff;border:1px solid #ddd;border-radius:10px;padding:16px;margin:12px 0}
    .btn{display:inline-block;background:#111;color:#fff;padding:10px 14px;border-radius:10px;text-decoration:none;font-weight:700;border:none;cursor:pointer}
    .muted{color:#555}
    footer{padding:18px;text-align:center;color:#666}
    ul{margin:8px 0 0 18px}
    code{background:#f3f3f3;padding:2px 6px;border-radius:6px}
  </style>
</head>

<body>
  <header>
    <h1>AE Core — Safety & Verification Hub</h1>
    <div class="muted">Education • Consent • Verification • No explicit content hosted</div>
    <nav style="margin-top:10px">
      <a href="index.html">Home</a>
      <a href="resources.html">Resources</a>
      <a href="verify.html">Get Verified</a>
      <a href="policies.html">Policies</a>
    </nav>
  </header>

  <main>
    <!-- DEBUG CARD -->
    <div class="card">
      <h2>Debug</h2>
      <div id="debugText" class="muted">Loading…</div>
      <div class="muted" style="margin-top:10px">
        Step 10 only works when opened via the Pi sandbox launcher URL (Step 6), e.g.
        <code>https://sandbox.minepi.com/app/...</code>
      </div>
    </div>

    <div class="card">
      <h2>What this is</h2>
      <p>
        AE Core provides education and safety resources, plus optional verification profiles for legal entertainment
        businesses and creators. We do not host explicit content. We remove listings that solicit illegal activity.
      </p>

      <a class="btn" href="verify.html">Create a Verification Profile</a>
      <button class="btn" style="margin-left:10px" onclick="alert('CLICK WORKS'); testPayment();">Test Payment (Pi)</button>

      <p class="muted" style="margin-top:12px">
        This button is only for Step 10 validation.
      </p>
    </div>

    <div class="card">
      <h2>Why it exists</h2>
      <ul>
        <li><b>Consent-first</b> boundaries and policies people can actually follow</li>
        <li><b>Safety</b> resources and reporting paths</li>
        <li><b>Financial literacy</b> basics (taxes, scams, budgeting)</li>
        <li><b>Verification</b> to reduce fraud and impersonation</li>
      </ul>
    </div>

    <div class="card">
      <h2>Directory (coming online)</h2>
      <p class="muted">Verified member listings will appear here after launch. For now, start by creating a profile.</p>
    </div>
  </main>

  <footer>
    AE Core — Safety & Verification
  </footer>

  <!-- Pi SDK + Payment test -->
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <script>
    function setDebug(msg) {
      console.log(msg);
      const el = document.getElementById("debugText");
      if (el) el.innerText = msg;
    }

    // Initial debug status
    setDebug("Page loaded. Checking for Pi SDK injection…");

    // Force sandbox mode for Step 10 testing (your app is Testnet)
    if (!window.Pi) {
      setDebug("❌ window.Pi NOT found. This is NOT a Pi app session. Open this page via the Pi sandbox launcher URL from Step 6.");
    } else {
      setDebug("✅ window.Pi found. Initializing Pi SDK (sandbox=true)…");
      Pi.init({ version: "2.0", sandbox: true });
      setDebug("✅ Pi SDK initialized. Ready to authenticate/pay.");
    }

    async function testPayment() {
      try {
        if (!window.Pi) {
          alert("Pi SDK not injected. Open using the sandbox launcher URL from Step 6.");
          setDebug("❌ Payment blocked: window.Pi not found.");
          return;
        }

        setDebug("Authenticating (payments scope)…");
        await Pi.authenticate(["payments"], (payment) => {
          console.log("Incomplete payment found:", payment);
        });
        setDebug("✅ Auth OK. Creating payment…");

        const paymentData = {
          amount: 0.01,
          memo: "AE Core setup test",
          metadata: { purpose: "setup-test" }
        };

        const paymentCallbacks = {
          onReadyForServerApproval: (paymentId) => {
            setDebug("⚠️ Ready for server approval: " + paymentId + " (This may require a small backend to approve/complete.)");
          },
          onReadyForServerCompletion: (paymentId, txid) => {
            setDebug("✅ Ready for completion. paymentId=" + paymentId + " txid=" + txid);
            alert("Payment flow started. Go back to Pi checklist and refresh Step 10.");
          },
          onCancel: (paymentId) => {
            setDebug("❌ Payment cancelled. paymentId=" + paymentId);
            alert("Payment cancelled.");
          },
          onError: (error, payment) => {
            const msg = error?.message || JSON.stringify(error);
            setDebug("❌ Payment error: " + msg);
            alert("Payment error: " + msg);
          }
        };

        await Pi.createPayment(paymentData, paymentCallbacks);
        setDebug("✅ Pi.createPayment called. Waiting for Pi callbacks…");

      } catch (e) {
        const msg = e?.message || JSON.stringify(e);
        setDebug("❌ Caught error: " + msg);
        alert("Caught error: " + msg);
      }
    }
  </script>
</body>
</html>


